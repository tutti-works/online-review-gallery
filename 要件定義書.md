## **オンライン講評会支援ギャラリーアプリ 要件定義書**

### **1\. 概要**

#### **1.1. プロジェクトの背景と目的**

大学の設計課題などにおいて、従来は対面で行われていた作品の講評会がオンラインへ移行しつつある。しかし、ファイルの共有やフィードバックを一元的に、かつ効率的に行うための最適なツールが存在しない。  
本プロジェクトは、Google Classroomに提出された学生の作品（画像、PDF等）を自動的に取得し、視覚的に優れたギャラリー形式で一覧表示するWebアプリケーションを開発することを目的とする。これにより、教員が行うオンライン講評会を円滑にし、インタラクティブなフィードバックの機会を創出する。

#### **1.2. 開発するシステムの概要**

本システムは、管理者（教員・TA）が操作するデータインポート機能を持つ。この機能はGoogle Classroom APIおよびGoogle Drive APIと連携し、指定された課題の提出物を取得する。取得されたファイルはWeb表示に最適化された画像（JPG）に変換され、Firebase Storageにアップロードされる。  
利用者は、Firebase Storage上の画像をPinterestのようなMasonryレイアウトのギャラリーで閲覧し、管理者は各作品に対して「いいね」やコメント形式でのフィードバックを行える。

---

### **2\. システムの利用者と役割**

本システムの利用者は以下の通りとし、役割（ロール）に応じて利用できる機能を制限する。

| 役割 | 利用者 | 主な操作 |
| :---- | :---- | :---- |
| **管理者 (Admin)** | 教員, TA | Googleアカウントでログイン。データインポート機能の実行、作品の閲覧、全作品への「いいね」・コメントの投稿/削除。 |
| **閲覧者 (Viewer)** | 学生 | Googleアカウントでログイン。自身が所属する授業のギャラリーの閲覧のみ。 |

---

### **3\. 機能要件**

#### **3.1. ユーザー認証機能 (F-01)**

* **F-01-01: Googleサインイン**  
  * 利用者は自身のGoogleアカウントを使用してシステムにサインインできる。  
* **F-01-02: 役割（ロール）判定**  
  * サインインしたGoogleアカウントが、事前にFirestoreに登録されたリストに基づき、「管理者」か「閲覧者」かを自動的に判定する。  
* **F-01-03: アクセス制御**  
  * 役割に応じて、操作可能な機能へのアクセスを制限する。閲覧者は閲覧以外の操作（いいね、コメント投稿など）は行えない。

#### **3.2. データインポート機能 (F-02)**

* **F-02-01: インポート対象の選択**  
  * 管理者は、Google Classroom上のクラスと特定の課題を選択し、インポート対象として指定できる。
* **F-02-02: 提出物の変換とアップロード**  
  * 管理者がインポートを実行すると、Firebase Functionsが起動する。
  * 指定された課題の全提出物ファイル（画像、PDF）をGoogle Driveからダウンロードする。
  * **画像ファイルの場合:** Web表示に適したサイズにリサイズ・最適化する。
  * **PDFファイルの場合:** PDFの各ページを、それぞれ個別のJPG画像に変換する。
  * 変換・最適化して生成された全てのJPG画像をFirebase Storageにアップロードする。
* **F-02-03: メタデータの保存**  
  * 作品のメタデータ（ファイル名, 作成者など）と、Firebase Storageにアップロードされた画像URLのリストをFirestoreに保存する。

#### **3.3. ギャラリー表示機能 (F-03)**

* **F-03-01: Masonryレイアウト表示**  
  * 異なるサイズ・アスペクト比の作品を、隙間なく美しく配置するMasonryレイアウトで表示する。
  * 複数ページある作品（元がPDF）の場合は、1ページ目の画像がサムネイルとして表示される。
* **F-03-02: 作品の拡大・複数ページ表示**  
  * ギャラリー上のサムネイルをクリックすると、作品をモーダルウィンドウ等で拡大表示する。
  * 作品が複数ページで構成される場合（元がPDF）、モーダル内で「次へ」「前へ」といったナビゲーションを提供し、全ページを閲覧できるようにする。
* **F-03-03: 遅延読み込み**  
  * 多数の作品を効率的に表示するため、無限スクロールまたはページネーションを実装する。

#### **3.4. 評価・フィードバック機能 (F-04)**

* **F-04-01: いいね機能**  
  * 管理者は、各作品に対して「いいね」を付けることができる。一度のみクリック可能で、再度クリックすると解除される。  
  * 「いいね」の総数は作品ごとにリアルタイムで表示される。  
* **F-04-02: コメント機能**  
  * 管理者は、各作品に対してテキストコメントを投稿できる。  
  * 投稿されたコメントは、投稿者名（Googleアカウント名）とタイムスタンプと共に時系列で表示される。  
  * 管理者は自身が投稿したコメントを削除できる。

---

### **4\. 非機能要件**

| 項目 | 要件 |
| :---- | :---- |
| **パフォーマンス** | ・ギャラリーの初回表示（主要コンテンツの描画完了）が3秒以内であること。<br>・「いいね」やコメントの反映は非同期で行い、ユーザー操作を妨げないこと。<br>・データインポート処理は、100件程度のファイル数をタイムアウトせずに安定して処理できること。 |
| **UI/UX** | ・直感的で学習コストの低いインターフェースであること。 ・レスポンシブデザインに対応し、PCおよびタブレットのブラウザで最適に表示されること。 |
| **セキュリティ** | ・Firebase AuthenticationとFirestoreのセキュリティルールを適切に設定し、権限のない利用者によるデータの読み書きを完全に防止すること。 ・APIキーなどの機密情報は適切に管理すること。 |
| **可用性** | ・VercelおよびFirebaseのSLAに準拠し、安定したサービス稼働を目指す。 |
| **動作環境** | ・**対応ブラウザ:** 最新バージョンのGoogle Chrome, Safari, Firefox, Microsoft Edge。 |

---

### **5\. システム構成**

* **フロントエンド:** Next.js (React)  
* **バックエンド:** Firebase Functions (第2世代)。タイムアウトを回避し安定処理を実現するため、ファイルごとに個別の関数が起動する非同期分散処理（ファンアウト）アーキテクチャを採用する。また、PDF等の重い処理に対応するため、メモリは1GB以上に増量してデプロイする。
* **データベース:** Firestore  
* **ファイルストレージ:** Firebase Storage (作品画像のホスティング用)
* **認証:** Firebase Authentication (Google Sign-In)  
* **外部API連携:** Google Drive API, Google Classroom API (※データインポート機能でのみ利用)
* **ホスティング/デプロイ:** Vercel

---

### **6\. 開発スコープ**

#### **6.1. 範囲内（やること）**

* 上記の機能要件（F-01〜F-04）に記載された全ての機能の実装。
* PDFファイルの各ページを画像に変換し、複数ページの作品をページめくり形式で閲覧できる機能。
* 画像（JPEG, PNG, GIF）ファイルの最適化と表示対応。

#### **6.2. 範囲外（やらないこと）**

* **動画ファイルのストリーミング再生:** 動画ファイルはインポート対象外とする。
* **学生間のピアレビュー機能:** 学生による「いいね」やコメント機能は実装しない。  
* **リアルタイム共同編集機能:** 複数人が同時に一つのコメントを編集する機能は含めない。  
* **オフライン機能:** インターネット接続が必須となる。  
* **高度な管理者ダッシュボード:** 利用者アカウントの管理や利用状況の統計分析などの機能は本プロジェクトの範囲外とする。